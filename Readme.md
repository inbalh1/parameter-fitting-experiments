These are the experiments for the paper "Robust Parameter Fitting to Realistic Network Models via Iterative Stochastic Approximation".

Additional data can be found at https://doi.org/10.5281/zenodo.10629451.

# Installation

- Make sure you have Python, Pip and R installed.
- Checkout this repository
- (Recommended) Create a Conda environment using the provided `environment.yml` file:

```
conda env create -f environment.yml
```

- Alternatively, install the Python dependencies manually using Pip (better to run with python version 3.10 or 3.11):

```
pip3 install -r requirements.txt
```

- Install the `pygirgs` package at https://github.com/PFischbeck/pygirgs

- Install the R dependencies (used for plots) with

```
R -e 'install.packages(c("ggplot2", "reshape2", "plyr", "dplyr", "scales"), repos="https://cloud.r-project.org/")'
```

- Download the file `konect-data.zip` from [Zenodo](https://doi.org/10.5281/zenodo.10629451) and extract its contents into the folder `input_data/konect`
- Optional: Download the file `output-data.zip` from [Zenodo](https://doi.org/10.5281/zenodo.10629451) and extract its contents into the folder `output_data`. This way, you can access all experiment results without running them yourself.

# File structure

- The folder `input_data` contains all networks used (KONECT) and generated (by random network models).
- The folder `output_data` contains all data and figures generated by the experiments.
- The files `experiments-*.py` are used for executing the Python experiments.
- The folder `R` contains R scripts for generating the plots.
- The folder `plots` contains all plots generated by the R scripts.

# Executing the experiments

- Execute `python3 experiments-models.py <experiment_name>` to run experiments related to the models. The different experiments are as follows:
  - For some `<model>` in `"erdos-renyi", "chung-lu-pl", "girg-1d"`, run:
    - `sample_and_measure_<model>` to sample from the model and measure the resulting feature values
    - `fit_parameters_<model>` to fit the parameters via the ParFit algorithm
    - `fitted_sample_and_measure_<model>` to sample and measure features based on the fitted parameters
  - `merge_csv` to merge all files for further processing in R
- Execute `python3 experiments-konect.py <experiment_name>` to run experiments related to the real-world networks. The different experiments are as follows:
  - `clean_graphs` to convert each real-world network to its largest component and convert the format
  - `measure_target_features` to measure the target features for every real-world network
  - For some `<model>` in `"erdos-renyi", "chung-lu-pl", "girg-1d"`, run:
    - `fit_parameters_<model>` to fit the parameters via the ParFit algorithm
    - `fitted_sample_and_measure_<model>` to sample and measure features based on the fitted parameters
  - `merge_csv` to merge all files for further processing in R
- Execute `python3 experiments-ablation.py <experiment_name>` to run experiments related to the ParFit configuration (i.e., alpha and threshold values). The different experiments are as follows:
  - For some `<model>` in `"erdos-renyi", "chung-lu-pl", "girg-1d"`, run:
    - `fit_parameters_alpha_<model>` to fit the parameters via the ParFit algorithm (for alpha experiments)
    - `fit_parameters_threshold_<model>` to fit the parameters via the ParFit algorithm (for treshold experiments)
    - `fitted_sample_and_measure_alpha_<model>` to sample and measure features based on the fitted parameters (for alpha experiments)
    - `fitted_sample_and_measure_threshold_<model>` to sample and measure features based on the fitted parameters (for threshold experiments)
  - `merge_csv` to merge all files for further processing in R

# Running R scripts

Run `Rscript R/<scriptname>` to run R scripts, found in the `R`subfolder. For example, run `Rscript R/erdos-renyi-ablation-alpha.R` to generate figures and tables related to the effect of the alpha configuration of ParFit for the ER model. The resulting figures and tables can be found in `output_data/figures`.

## Running the Maximum-Likelihood Estimation (MLE)

To run the maximum-likelihood estimation (MLE) procedure, follow these steps:

1. **Run the MLE experiments to generate the data**  
- Execute `python3 experiments-mle.py <experiment_name>` to generate training and test data. These experiments sample graphs and measure the resulting features. The experiments:
  - `train_data_<model>`: generates training data
  - `test_data_<model>`: generates test data
**Make sure to run all training and test experiments for all models** before proceeding to the next step. The notebook depends on this data being available.

2. **Open the Colab notebook**  
Open the provided notebook (`mle_analysis.ipynb`) in [Google Colab](https://colab.research.google.com/) or locally in Jupyter.

3. **Update the base directory if needed**  
If you're running the Colab notebook **in the cloud** or **from a different folder structure**, make sure to update the `base_dir` variable at the beginning of the notebook. It should point to the location of the MLE data generated in step 1, inside `output_data/target_params/mle`.


## Structure of experiments output 
Running the experiments generates output under the `output_data/` directory, organized by experiment type and model. Here's an overview:
- **`sample_and_measure_<model>`**  
  Stores results in:
  - `output_data/target_params/`
  - `output_data/attributes/`

- **`fit_parameters_<model>`**  
  Stores fitted parameters in:
  - `output_data/fitted_params/`

- **`fitted_sample_and_measure_<model>`**  
  Stores feature measurements in:
  - `output_data/fitted_features/`

- **Real-world graph experiments:**
  - **`clean_graphs`**  
    Creates cleaned versions of networks in:
    - `input_data/clean/`

- **MLE experiments (`train_data_<model>`, `test_data_<model>`)**  
  Store generated data in:
  - `output_data/target_params/mle/`

- **MLE results (from the notebook):**  
  The analysis results produced by the `ipynb` notebook are saved in the `output/` subdirectory inside the path defined by the `base_dir` variable.  
  By default, this means:
  - `output_data/target_params/mle/output/`  
  If you run the notebook from a different location (e.g., in the cloud or another directory), make sure `base_dir` is set accordingly.
